# Below cmd should be run on master
wget https://apt.puppetlabs.com/puppet8-release-jammy.deb  
sudo dpkg -i puppet8-release-jammy.deb 
sudo apt update
sudo apt install puppetserver
# Line no 7 and 8 should be done only if your lab has less memory else ignore
sudo nano /etc/default/puppetserver
JAVA_ARGS="-Xms1g -Xmx1g -Djruby.logger.class=com.puppetlabs.jruby_utils.jruby.Slf4jLogger"
sudo systemctl start puppetserver
sudo systemctl enable puppetserver
sudo systemctl status puppetserver
sudo ln -s /opt/puppetlabs/bin/puppet /usr/local/bin/puppet


# Below cmd should be run on each and every Agent
wget https://apt.puppetlabs.com/puppet8-release-jammy.deb  
sudo dpkg -i puppet8-release-jammy.deb 
sudo apt update
sudo apt install puppet-agent
sudo nano /etc/puppetlabs/puppet/puppet.conf
#Add the following lines to the end of the Puppet configuration file to define the Puppet master information:
[main]
certname = puppetclient
server = puppetmaster
sudo systemctl start puppet
sudo systemctl enable puppet
sudo systemctl status puppet
sudo /opt/puppetlabs/bin/puppetserver ca list --all
sudo /opt/puppetlabs/bin/puppetserver ca sign --all


# /etc/puppetlabs/code/environments/development/modules/webserver/manifests/init.pp

class webserver {
  # This is an empty base class. 
  # It can be used for common webserver configurations in the future if needed.
}

# Class to install and configure Apache2
class webserver::apache {
  package { 'apache2':
    ensure => installed,
  }

  service { 'apache2':
    ensure => running,
    enable => true,
  }

  file { '/var/www/html/index.html':
    ensure  => present,
    content => "<h1>Apache Webserver is running</h1>",
  }
}

# Class to install and configure Tomcat
class webserver::tomcat {
  package { 'tomcat':
    ensure => installed,
  }

  service { 'tomcat':
    ensure => running,
    enable => true,
  }

  # Optional: Deploy a sample application or set configurations
  file { '/opt/tomcat/webapps/sample.war':
    ensure  => present,
    source  => 'puppet:///modules/webserver/sample.war',
    require => Package['tomcat'],
  }
}


